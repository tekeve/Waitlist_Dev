{% extends "base.html" %}
{% load humanize %}
<!-- Set the page title -->
{% block title %}Doctrine Fittings{% endblock %}

{% block styles %}
<style>
    .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
    }

    h1 {
        border-bottom: 0px solid #444;
        padding-bottom: 10px;
        margin-top: 0;
    }

    /* ---
    --- NEW CARD LAYOUT STYLES
    --- */

    .category-section {
        margin-bottom: 30px;
    }

    .category-header {
        font-size: 1.8em;
        font-weight: 600;
        color: #fff;
        border-bottom: 0px solid #555;
        padding-bottom: 8px;
        margin-bottom: 15px;
    }

    .fittings-grid {
        display: grid;
        /* --- MODIFICATION: More responsive columns --- */
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
    }

    .ship-card-button {
        /* This is the new clickable card */
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #2a2a2a;
        border: 0px solid #444;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s;
        /* --- NEW: Text alignment --- */
        text-align: left;
    }

        .ship-card-button:hover {
            background: #333;
            transform: translateY(-2px);
        }

    .ship-card-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid #555;
        flex-shrink: 0;
    }

    .ship-card-info {
        display: flex;
        flex-direction: column;
        /* --- NEW: Allow shrinking --- */
        min-width: 0;
    }

    .ship-card-name {
        font-size: 1.1em;
        font-weight: 600;
        color: #fff;
        /* --- NEW: Truncate text --- */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .ship-card-description {
        font-size: 0.9em;
        color: #aaa;
        /* --- NEW: Truncate text --- */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    /* ---
    --- END NEW CARD STYLES
    --- */
</style>
{% endblock %}


{% block content %}
<div class="container">
    <h1>Doctrine Fittings</h1>

    {% for category in grouped_fits %}
    <div class="category-section">
        <h2 class="category-header">{{ category.name }}</h2>

        <div class="fittings-grid">
            {% for fit in category.fits %}
            <!--
            This is the new clickable card.
            It calls the JS function defined in base.html
            -->
            <button class="ship-card-button"
                    onclick="openDoctrineFitModal({{ fit.id }})">

                {% if fit.ship_type %}
                <img src="https://images.evetech.net/types/{{ fit.ship_type.type_id }}/icon?size=64"
                     alt="{{ fit.ship_type.name }}"
                     class="ship-card-icon">
                {% else %}
                <!-- Fallback icon -->
                <img src="https://placehold.co/64x64/2a2a2a/999?text=?"
                     alt="Unknown Ship"
                     class="ship-card-icon">
                {% endif %}

                <div class="ship-card-info">
                    <span class="ship-card-name" title="{{ fit.name }}">{{ fit.name }}</span>
                    <span class="ship-card-description" title="{{ fit.description|default:'' }}">
                        {{ fit.description|default:''|truncatewords:10 }}
                    </span>
                </div>
            </button>
            {% endfor %}
        </div>
    </div>
    {% empty %}
    <p>There are no doctrine fits configured in the database.</p>
    {% endfor %}
</div>
{% endblock %}


{% block scripts %}
<!--
This script block is now only for the *public* fittings page modal.
The logic has been moved to base.html so it can be shared.
We just need to ensure the `openDoctrineFitModal` function is
available from the `base.html` script block.
-->
{% endblock %}